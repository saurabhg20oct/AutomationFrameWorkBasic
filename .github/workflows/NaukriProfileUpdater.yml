name: NaukriProfileUpdater

on:
  schedule:
    - cron: "30 2 * * *"
    - cron: "30 14 * * *"
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Java 24 (latest LTS)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '24'
          cache: gradle

      - name: Upgrade system packages
        run: |
          sudo apt-get update
          sudo apt-get -y upgrade

      - name: Install Google Chrome
        uses: browser-actions/setup-chrome@v1
      - name: Start virtual display
        run: |
          sudo apt-get install -y xvfb
          Xvfb :99 -screen 0 1920x1080x24 > /dev/null 2>&1 &
          export DISPLAY=:99
          echo "DISPLAY=:99" >> $GITHUB_ENV	

      - name: Make gradlew executable
        run: chmod +x seleniumRevision/gradlew

      - name: Upgrade Gradle wrapper
        working-directory: seleniumRevision
        run: ./gradlew wrapper --gradle-version 9.0.0 --distribution-type all

      - name: Build with Gradle
        working-directory: seleniumRevision
        run: ./gradlew clean build --stacktrace

      - name: Run NaukriProfileUpdater
        working-directory: seleniumRevision
        run: ./gradlew run --args="$NAUKRI_USERNAME $NAUKRI_PASSWORD naukri.NaukriProfileUpdater"
        env:
          NAUKRI_USERNAME: ${{ secrets.NAUKRI_USERNAME }}
          NAUKRI_PASSWORD: ${{ secrets.NAUKRI_PASSWORD }}

      - name: Upload screenshots
        uses: actions/upload-artifact@v4
        with:
          name: screenshots
          path: seleniumRevision/screenshots/
          retention-days: 1
